<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>师生管理平台</title>
  <!-- FullCalendar -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.8/index.global.min.js"></script>
  <!-- 样式 -->
  <link rel="stylesheet" href="appV3.css"/>
</head>
<body>
  <!-- 顶栏 -->
  <header class="topbar">
    <button id="hamburger" aria-label="打开菜单" style="display:none;">☰</button>
    <div class="brand">师生管理平台</div>
    <div class="spacer"></div>
    <div id="userBadge" class="user-badge" style="display:none;">
      <span id="greeting"></span>
      <button id="logoutBtn" class="btn btn-outline">退出</button>
    </div>
  </header>

  <!-- 登录 -->
  <main id="loginContainer" class="center-wrap">
    <section class="card card-narrow">
      <h1 class="title">登录</h1>
      <div class="form-row">
        <label for="loginUsername" class="label">用户ID</label>
        <input id="loginUsername" class="input" placeholder="例如：S001 / T001 / A001" />
      </div>
      <button id="loginBtn" class="btn btn-solid btn-full">登录</button>
      <div id="loginError" class="error"></div>

      <details class="mt-16">
        <summary class="small">没有账号？登记信息</summary>
        <div class="grid2 mt-8">
          <input id="registerName" class="input" placeholder="姓名"/>
          <input id="registerEmail" class="input" placeholder="邮箱"/>
          <select id="registerDepartment" class="input">
            <option value="">所属</option><option>文科大学院</option><option>理科大学院</option><option>其他</option>
          </select>
          <input id="registerMajor" class="input" placeholder="专业"/>
          <select id="registerRole" class="input">
            <option value="">身份</option><option>学生</option><option>老师</option>
          </select>
        </div>
        <button id="registerBtn" class="btn btn-outline mt-8">提交登记</button>
        <div id="registerError" class="error"></div>
      </details>
      <div id="apiStatusTip" class="muted small mt-12">正在检测 API…</div>
    </section>
  </main>

  <!-- 主页面：登录后显示 -->
  <main id="appContainer" class="app" style="display:none;">
    <div class="app-layout">
      <!-- 侧栏（登录后常驻；桌面固定，移动抽屉） -->
      <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">导航</div>
        <nav class="nav">
          <a class="nav-link active" href="#calendar">日历</a>
          <a class="nav-link" href="arrange.html">课程安排（子页）</a>
          <a class="nav-link" href="analysis.html">数据分析（子页）</a>
          <a class="nav-link" href="myschedule.html">我的日程（子页）</a>
          <a class="nav-link" href="profile.html">个人信息（子页）</a>
        </nav>
        <div class="sidebar-footer">
          <button id="refreshBtn" class="btn btn-outline btn-full">刷新日历</button>
          <div id="apiPing" class="muted small">API: —</div>
        </div>
      </aside>

      <!-- 主内容：默认显示主日历；子页面用 iframe 承载 -->
      <section class="page">
        <section id="calendarCard" class="card">
          <div class="calendar-head">
            <div class="calendar-title" id="calendarTitle">—</div>
            <div class="calendar-ctrl">
              <button id="prevBtn" class="btn btn-outline">‹</button>
              <button id="todayBtn" class="btn btn-outline">今天</button>
              <button id="nextBtn" class="btn btn-outline">›</button>
              <div class="seg">
                <button id="dayBtn" class="seg-btn active">日</button>
                <button id="weekBtn" class="seg-btn">周</button>
                <button id="monthBtn" class="seg-btn">月</button>
              </div>
            </div>
          </div>
          <div id="mainCalendar"></div>
        </section>

        <!-- 子页面容器（默认隐藏），用于 iframe 承载“课程安排/数据分析”等 -->
        <section id="pageHost" class="card" style="display:none;">
          <iframe id="subPage" title="子页面" frameborder="0"></iframe>
        </section>
      </section>
    </div>

    <!-- 移动端遮罩（桌面不会显示） -->
    <div id="backdrop" class="backdrop"></div>
  </main>

  <!-- 逻辑 -->
  <script src="appV3.js" defer></script>
</body>
</html>